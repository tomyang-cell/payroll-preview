<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>급여대장 미리보기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    <style>
        :root { --primary:#2563eb; --bg:#f7f8fa; }
        body { font-family:Pretendard,system-ui,-apple-system,Segoe UI,Roboto,sans-serif; background:var(--bg); }
        .card { background:#fff; border-radius:12px; box-shadow:0 1px 3px rgba(0,0,0,.05); padding:1.25rem; }
        .btn-primary { background:var(--primary); color:#fff; border-radius:12px; padding:.75rem 1rem; font-weight:600; transition:.2s; }
        .btn-primary:hover { background:#1d4ed8; }
        .btn-ghost { color:var(--primary); font-weight:600; padding:.25rem .5rem; border-radius:8px; }
        .section-h { display:flex; justify-content:space-between; align-items:center; padding-bottom:.5rem; margin-bottom:.5rem; border-bottom:1px solid #e5e7eb; }
        .mono { font-family:ui-monospace,SFMono-Regular,Menlo,Roboto Mono,monospace; }
        .chev { transition:transform .2s ease; }
        .chev.rot { transform:rotate(90deg); }
        .hidden-content { display:none; }
        
        /* 기존 스타일 병합 및 조정 */
        .message-container {
            width: 100%;
            max-width: 375px;
            padding: 1rem;
            box-sizing: border-box;
            background-color: #fff;
        }
        .chat-bubble {
            background-color: #ffe633;
            border-radius: 0.75rem;
            padding: 1rem;
            position: relative;
            max-width: 80%;
            margin-left: auto;
            word-wrap: break-word;
        }
        .chat-bubble::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            width: 0;
            height: 0;
            border: 0.5rem solid transparent;
            border-left-color: #ffe633;
            border-right: 0;
            margin-top: -0.5rem;
            margin-right: -0.4rem;
        }
        .btn-link {
            background-color: white;
            color: #333;
            border: 1px solid #ddd;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            text-align: center;
            cursor: pointer;
            margin-top: 0.5rem;
        }
        .fade-in {
            animation: fadeInAnimation 0.5s ease-in;
        }
        @keyframes fadeInAnimation {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .collapsible-header {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
        }
        .collapsible-icon {
            transition: transform 0.3s ease;
        }
        .collapsible-icon.rotated {
            transform: rotate(90deg);
        }
        .download-button {
            background-color: #3b82f6;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            transition: background-color 0.2s;
            margin-right: 1rem;
        }
        .download-button.hidden {
            display: none;
        }
        .download-button:hover {
            background-color: #2563eb;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 flex flex-col items-center">

    <!-- 모바일 화면 목업 -->
    <div class="relative w-full h-full max-w-sm bg-gray-200 rounded-3xl shadow-xl overflow-hidden flex flex-col">
        <!-- 메시지 컨테이너 (초기 화면) -->
        <div id="message-mockup" class="w-full bg-white px-4 py-8 flex flex-col items-center justify-center">
            <!-- 채팅 버블 -->
            <div class="bg-yellow-300 rounded-xl p-4 w-11/12 max-w-xs shadow-md">
                <p class="text-sm text-gray-800">
                    안녕하세요, 홍길동님.<br>
                    2025년 9월 급여대장이 발행되었어요.
                </p>
                <div id="check-payroll-btn" class="btn-link mt-4 text-sm font-semibold text-gray-800 hover:bg-gray-50 transition">
                    급여대장 확인하기
                </div>
            </div>
        </div>

        <!-- 급여대장 미리보기 화면 (숨김) -->
        <div id="payroll-table-view" class="hidden-content w-full h-full p-4 overflow-y-auto">
            <main class="w-full bg-white rounded-lg shadow-lg overflow-hidden flex flex-col">
                <!-- 헤더 -->
                <header class="w-full text-center p-4 border-b border-gray-200">
                    <h1 class="text-lg font-bold text-gray-800">2025년 9월분 급여대장</h1>
                    <h2 class="text-sm font-semibold text-gray-600 mt-1">심플솔루션 (4247200353)</h2>
                </header>

                <div class="flex flex-col p-4 space-y-4">

                    <!-- 근로소득 섹션 (2명) -->
                    <div class="bg-gray-100 p-4 rounded-lg shadow-inner" id="income-section-근로소득">
                        <h3 class="text-md font-bold text-gray-800 mb-2 collapsible-header">
                            <div class="flex items-center flex-grow">
                                <span>근로소득 (2명)</span>
                            </div>
                            <div class="flex items-center">
                                <!-- 이벤트 전파를 막아 부모 요소의 클릭 이벤트를 방지합니다. -->
                                <button class="download-button hidden" onclick="downloadPdf(event, '근로소득')">PDF 다운로드</button>
                                <span class="collapsible-icon ml-2 transform transition-transform duration-300">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right"><path d="m9 18 6-6-6-6"/></svg>
                                </span>
                            </div>
                        </h3>
                        
                        <div class="collapsible-content space-y-4 hidden-content">
                            <!-- 근로소득 첫 번째 직원 -->
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <div class="text-sm font-bold border-b pb-2 mb-2">김근로</div>
                                <div class="flex justify-between items-center py-1 text-sm text-gray-700">
                                    <span class="font-medium">기본급</span>
                                    <span>2,500,000원</span>
                                </div>
                                <div class="flex justify-between items-center py-1 text-sm text-gray-700">
                                    <span class="font-medium">공제합계</span>
                                    <span>250,000원</span>
                                </div>
                                <div class="flex justify-between items-center py-1 text-sm font-bold text-blue-800 border-t mt-2 pt-2">
                                    <span class="font-medium">차인 지급액</span>
                                    <span>2,250,000원</span>
                                </div>
                            </div>

                            <!-- 근로소득 두 번째 직원 -->
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <div class="text-sm font-bold border-b pb-2 mb-2">박근로</div>
                                <div class="flex justify-between items-center py-1 text-sm text-gray-700">
                                    <span class="font-medium">기본급</span>
                                    <span>3,000,000원</span>
                                </div>
                                <div class="flex justify-between items-center py-1 text-sm text-gray-700">
                                    <span class="font-medium">공제합계</span>
                                    <span>300,000원</span>
                                </div>
                                <div class="flex justify-between items-center py-1 text-sm font-bold text-blue-800 border-t mt-2 pt-2">
                                    <span class="font-medium">차인 지급액</span>
                                    <span>2,700,000원</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 사업소득 섹션 (3명) -->
                    <div class="bg-gray-100 p-4 rounded-lg shadow-inner" id="income-section-사업소득">
                        <h3 class="text-md font-bold text-gray-800 mb-2 collapsible-header">
                            <div class="flex items-center flex-grow">
                                <span>사업소득 (3명)</span>
                            </div>
                            <div class="flex items-center">
                                <!-- 이벤트 전파를 막아 부모 요소의 클릭 이벤트를 방지합니다. -->
                                <button class="download-button hidden" onclick="downloadPdf(event, '사업소득')">PDF 다운로드</button>
                                <span class="collapsible-icon ml-2 transform transition-transform duration-300">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right"><path d="m9 18 6-6-6-6"/></svg>
                                </span>
                            </div>
                        </h3>

                        <div class="collapsible-content space-y-4 hidden-content">
                            <!-- 사업소득 첫 번째 직원 -->
                            <div class="bg-white p-4 rounded-lg shadow-sm mb-4">
                                <div class="text-sm font-bold border-b pb-2 mb-2">김사업</div>
                                <div class="flex justify-between items-center py-1 text-sm text-gray-700">
                                    <span class="font-medium">기본급</span>
                                    <span>1,500,000원</span>
                                </div>
                                <div class="flex justify-between items-center py-1 text-sm text-gray-700">
                                    <span class="font-medium">공제합계</span>
                                    <span>45,000원</span>
                                </div>
                                <div class="flex justify-between items-center py-1 text-sm font-bold text-blue-800 border-t mt-2 pt-2">
                                    <span class="font-medium">차인 지급액</span>
                                    <span>1,455,000원</span>
                                </div>
                            </div>
                            
                            <!-- 사업소득 두 번째 직원 -->
                            <div class="bg-white p-4 rounded-lg shadow-sm mb-4">
                                <div class="text-sm font-bold border-b pb-2 mb-2">이사업</div>
                                <div class="flex justify-between items-center py-1 text-sm text-gray-700">
                                    <span class="font-medium">기본급</span>
                                    <span>1,800,000원</span>
                                </div>
                                <div class="flex justify-between items-center py-1 text-sm text-gray-700">
                                    <span class="font-medium">공제합계</span>
                                    <span>54,000원</span>
                                </div>
                                <div class="flex justify-between items-center py-1 text-sm font-bold text-blue-800 border-t mt-2 pt-2">
                                    <span class="font-medium">차인 지급액</span>
                                    <span>1,746,000원</span>
                                </div>
                            </div>

                            <!-- 사업소득 세 번째 직원 -->
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <div class="text-sm font-bold border-b pb-2 mb-2">최사업</div>
                                <div class="flex justify-between items-center py-1 text-sm text-gray-700">
                                    <span class="font-medium">기본급</span>
                                    <span>2,000,000원</span>
                                </div>
                                <div class="flex justify-between items-center py-1 text-sm text-gray-700">
                                    <span class="font-medium">공제합계</span>
                                    <span>60,000원</span>
                                </div>
                                <div class="flex justify-between items-center py-1 text-sm font-bold text-blue-800 border-t mt-2 pt-2">
                                    <span class="font-medium">차인 지급액</span>
                                    <span>1,940,000원</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 기타소득 섹션 (1명) -->
                    <div class="bg-gray-100 p-4 rounded-lg shadow-inner" id="income-section-기타소득">
                        <h3 class="text-md font-bold text-gray-800 mb-2 collapsible-header">
                            <div class="flex items-center flex-grow">
                                <span>기타소득 (1명)</span>
                            </div>
                            <div class="flex items-center">
                                <!-- 이벤트 전파를 막아 부모 요소의 클릭 이벤트를 방지합니다. -->
                                <button class="download-button hidden" onclick="downloadPdf(event, '기타소득')">PDF 다운로드</button>
                                <span class="collapsible-icon ml-2 transform transition-transform duration-300">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right"><path d="m9 18 6-6-6-6"/></svg>
                                </span>
                            </div>
                        </h3>
                        
                        <div class="collapsible-content space-y-4 hidden-content">
                            <!-- 기타소득 첫 번째 직원 -->
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <div class="text-sm font-bold border-b pb-2 mb-2">홍기타</div>
                                <div class="flex justify-between items-center py-1 text-sm text-gray-700">
                                    <span class="font-medium">기본급</span>
                                    <span>800,000원</span>
                                </div>
                                <div class="flex justify-between items-center py-1 text-sm text-gray-700">
                                    <span class="font-medium">공제합계</span>
                                    <span>120,000원</span>
                                </div>
                                <div class="flex justify-between items-center py-1 text-sm font-bold text-blue-800 border-t mt-2 pt-2">
                                    <span class="font-medium">차인 지급액</span>
                                    <span>680,000원</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 최종 지급액 카드 -->
                    <div class="bg-blue-100 p-4 rounded-lg shadow-sm">
                        <h3 class="text-md font-bold text-blue-800 border-b border-blue-200 pb-2 mb-2">전체 합계</h3>
                        <div class="flex justify-between items-center text-lg font-bold text-blue-800 py-1">
                            <span>총 지급액</span>
                            <span>10,860,000원</span>
                        </div>
                        <div class="flex justify-between items-center text-lg font-bold text-blue-800 py-1">
                            <span>총 공제액</span>
                            <span>839,000원</span>
                        </div>
                        <div class="flex justify-between items-center text-lg font-bold text-blue-800 py-1">
                            <span>총 차인 지급액</span>
                            <span>10,021,000원</span>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <script>
        document.getElementById('check-payroll-btn').addEventListener('click', function() {
            document.getElementById('message-mockup').classList.add('hidden-content');
            const payrollView = document.getElementById('payroll-table-view');
            payrollView.classList.remove('hidden-content');
            payrollView.classList.add('fade-in');
        });

        // 각 섹션 헤더에 클릭 이벤트 리스너 추가
        document.querySelectorAll('.collapsible-header').forEach(header => {
            header.addEventListener('click', () => {
                const content = header.nextElementSibling;
                const icon = header.querySelector('.collapsible-icon');
                const downloadButton = header.querySelector('.download-button');
                
                content.classList.toggle('hidden-content');
                icon.classList.toggle('rotated');
                if (downloadButton) {
                    downloadButton.classList.toggle('hidden');
                }
            });
        });
        
        window.jsPDF = window.jspdf.jsPDF;

        // downloadPdf 함수가 event 객체를 받도록 수정하고, 이벤트 전파를 막습니다.
        function downloadPdf(event, incomeType) {
            // 이벤트 전파를 중단하여 부모 요소의 클릭 이벤트가 실행되지 않도록 합니다.
            event.stopPropagation();

            const element = document.getElementById('income-section-' + incomeType);
            const fileName = `2025년 9월분 ${incomeType} 급여대장.pdf`;
            
            // html2canvas 옵션 설정
            const options = {
                scale: 2,
                useCORS: true,
                logging: true
            };
            
            html2canvas(element, options).then(canvas => {
                const imgData = canvas.toDataURL('image/jpeg', 1.0);
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgWidth = 210;
                const pageHeight = 295;
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;
                
                pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                pdf.save(fileName);
            });
        }
    </script>

</body>
</html>
